<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            max-width: 210px;
        }

        #tomato {
            color: rgb(236, 235, 235);
            mix-blend-mode: multiply;
            background-image: url(./pomodoro.jpg);
            background-repeat: no-repeat;
            background-size: 100%;
            background-position: center;
            background-position-x: 7.5px;
            height: 150px;
            width: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        blend {
            mix-blend-mode: multiply;
        }

        #clock,
        #minutes,
        #seconds {
            display: inline;
        }

        #box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #start,
        #pause,
        #reset {
            height: 50px;
            width: 50px;
            border: 2px solid lightgray;
            border-radius: 50%;
            color: rgb(236, 235, 235);
            font-size: 10px;
            font-weight: bold;
        }
        #start {
            background-color: rgb(9, 158, 9);
        }

        #pause {
            background-color: rgb(255, 174, 0);
        }
        #reset {
            background-color: rgb(221, 16, 16);
        }

        button[disabled] {
            opacity: .4;
        }

    </style>
</head>

<body>
    <div id="box">
        <div id="tomato" class="blend">
            <div id="clock">
                <div id="minutes">25</div>:<div id="seconds">00</div>
            </div>
        </div>

        <div id="buttons">
            <button id='start' onclick='start()'>START</button>
            <button id='pause' onclick="pause()">PAUSE</button>
            <button id='reset' onclick="reset()">RESET</button>

        </div>
    </div>

    <script>
        class Tomato {
           constructor(){

           } 

        }
        let totalSeconds = 1500;
        let endTime = 0;
        let intervalID = null;
        let rainbowID = null;

        reset();

        document.getElementById("clock").onclick = function adjustTime() {
            let currentSetting = document.getElementById("minutes").innerHTML;
            document.getElementById("minutes").innerHTML = (+currentSetting - 5).toString().padStart(2, '0');
            totalSeconds = totalSeconds - 300;
            if (currentSetting <= 4 || totalSeconds <= 300) {
                setDisplay("00", "01");
                totalSeconds = 1;
            }
        }

        function setDisplay(min, sec) {
            document.getElementById("minutes").innerHTML = min;
            document.getElementById("seconds").innerHTML = sec;
        }

        function manipulateButtons(enabledButton, disabledButton) {
            document.getElementById(disabledButton).disabled = true;
            document.getElementById(enabledButton).disabled = false;
        }

        function endTimeSecs() {
            let maxSeconds = totalSeconds + currentSeconds();
            return maxSeconds;
        }
        function currentSeconds() {
            let currSeconds = Math.floor(Date.now() / 1000);
            return currSeconds;
        }
        function minutesRemaining() {
            let minutes = Math.floor((endTime - currentSeconds()) / 60);
            return minutes.toString().padStart(2, '0');
        }
        function secondsRemaining() {
            let seconds = Math.floor(endTime - currentSeconds()) - (60 * minutesRemaining());
            return seconds.toString().padStart(2, '0');
        }

        function stopTimer() {
            console.log({intervalID})
            if (document.getElementById("minutes").innerHTML == 00 && document.getElementById("seconds").innerHTML == 00) {
                window.clearInterval(intervalID);
                document.getElementById("pause").disabled = true;
                let audio = new Audio('audio.wav');
                audio.play();
                rainbowID = window.setInterval(flashRainbow, 610);
            }
        }
        function flashRainbow(){
            window.setTimeout('flash("red")', 100);
            window.setTimeout('flash("orange")', 200);
            window.setTimeout('flash("yellow")', 300);
            window.setTimeout('flash("green")', 400);
            window.setTimeout('flash("blue")', 500);
            window.setTimeout('flash("purple")', 600);
            window.setTimeout('flash("#ffffff")', 610);
        }
        function flash(color) {
            document.body.style.backgroundColor = color;
        }
        // timer counts down from current number
        function timer() {
            setDisplay(minutesRemaining(), secondsRemaining());
            stopTimer();
        }

        // click start button: disables start button, starts clock, enables pause and reset
        function start() {
            endTime = endTimeSecs();
            intervalID = window.setInterval(timer, 100);
            manipulateButtons("pause", "start");
        };

        // click pause: pause button disabled, pause clock, start and reset buttons enabled
        function pause() {
            window.clearInterval(intervalID);
            totalSeconds = endTime - currentSeconds();
            manipulateButtons("start", "pause");
        };
        // click reset: pause disabled, start enabled, reset 'enabled', resets clock to 25:00.
        function reset() {
            totalSeconds = 1500;
            console.log('Clearing')
            console.log({rainbowID})
            window.clearInterval(rainbowID);
            window.clearInterval(intervalID);
            setDisplay('25', '00');
            manipulateButtons("start", "pause");
            flash('white');

        }
    </script>
</body>

</html>